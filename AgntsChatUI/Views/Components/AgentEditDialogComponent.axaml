<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AgntsChatUI.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="800"
             x:Class="AgntsChatUI.Views.Components.AgentEditDialogComponent"
             x:DataType="vm:AgentManagementViewModel">

	<!-- Agent Edit Dialog Overlay -->
	<Border IsVisible="{Binding IsEditing}"
            Background="#80000000"
            ZIndex="100">
		<Border Background="White"
                CornerRadius="12"
                Width="700"
                Height="650"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                BoxShadow="0 8 32 0 #40000000"
                Margin="40">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Header -->
				<Border Grid.Row="0" Padding="24,20" BorderBrush="#e8eaed" BorderThickness="0,0,0,1">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
							<Border Width="40" Height="40" CornerRadius="20" Background="#4285f4">
								<TextBlock Text="ðŸ¤–" Classes="TitleMedium" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
							</Border>
							<StackPanel>
								<TextBlock Text="{Binding SelectedAgent.Name, FallbackValue='New Agent'}" Classes="TitleMedium" FontWeight="Medium" Foreground="#202124"/>
								<TextBlock Text="Configure agent settings and behavior" Classes="BodySmall" Foreground="#5f6368"/>
							</StackPanel>
						</StackPanel>
						<Button Grid.Column="1"
                                Classes="IconButton"
                                Command="{Binding CancelEditCommand}"
                                Width="32" Height="32">
							<Path Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                  Fill="#5f6368"
                                  Stretch="Uniform"
                                  Width="16" Height="16"/>
						</Button>
					</Grid>
				</Border>

				<!-- Content -->
				<ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="0"
                              Margin="0">
					<StackPanel Spacing="24" Margin="24">
						
						<!-- Basic Information Section -->
						<StackPanel Spacing="16">
							<TextBlock Text="Basic Information" Classes="BodyMedium" FontWeight="Medium" Foreground="#202124"/>
							
							<!-- Agent Name Field -->
							<StackPanel Spacing="6">
								<TextBlock Text="Agent Name *" Classes="BodySmall" FontWeight="Medium" Foreground="#202124"/>
								<TextBox Text="{Binding AgentName}"
                                         Classes="BodyMedium"
                                         Padding="16,12"
                                         CornerRadius="8"
                                         BorderBrush="#dadce0"
                                         Background="White"
                                         Watermark="Enter agent name..."
                                         MaxLength="100"/>
								<TextBlock Classes="Caption" Text="Required field. Maximum 100 characters." Foreground="#5f6368"/>
							</StackPanel>

							<!-- Agent Description Field -->
							<StackPanel Spacing="6">
								<TextBlock Text="Description *" Classes="BodySmall" FontWeight="Medium" Foreground="#202124"/>
								<TextBox Text="{Binding AgentDescription}"
                                         Classes="BodyMedium"
                                         Padding="16,12"
                                         CornerRadius="8"
                                         BorderBrush="#dadce0"
                                         Background="White"
                                         Watermark="Enter agent description..."
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         Height="80"
                                         MaxLength="500"/>
								<TextBlock Classes="Caption" Text="Required field. Maximum 500 characters." Foreground="#5f6368"/>
							</StackPanel>
						</StackPanel>

						<!-- Instructions Section -->
						<StackPanel Spacing="16">
							<StackPanel Spacing="4">
								<TextBlock Text="Instructions" Classes="BodyMedium" FontWeight="Medium" Foreground="#202124"/>
								<TextBlock Classes="BodySmall" Text="Define the agent's behavior, guidelines, and capabilities in markdown format." Foreground="#5f6368" TextWrapping="Wrap"/>
							</StackPanel>
							
							<TextBox Text="{Binding AgentInstructions}"
                                     Classes="BodySmall"
                                     Padding="16,12"
                                     CornerRadius="8"
                                     BorderBrush="#dadce0"
                                     Background="White"
                                     Watermark="Enter detailed instructions for the agent..."
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     Height="200"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>
						</StackPanel>

						<!-- Prompty Template Section -->
						<StackPanel Spacing="16">
							<StackPanel Spacing="4">
								<TextBlock Text="Prompty Template" Classes="BodyMedium" FontWeight="Medium" Foreground="#202124"/>
								<TextBlock Classes="BodySmall" Text="Define the agent's persona and system prompt in prompty format." Foreground="#5f6368" TextWrapping="Wrap"/>
							</StackPanel>
							
							<TextBox Text="{Binding AgentPrompty}"
                                     Classes="BodySmall"
                                     Padding="16,12"
                                     CornerRadius="8"
                                     BorderBrush="#dadce0"
                                     Background="White"
                                     Watermark="Enter prompty template content..."
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     Height="200"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>
						</StackPanel>

						<!-- Status Messages -->
						<Border IsVisible="{Binding HasError}"
                                Background="#fce8e6"
                                BorderBrush="#f28b82"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<TextBlock Text="âš ï¸" Classes="BodyMedium" VerticalAlignment="Top"/>
								<TextBlock Classes="BodySmall" Text="Both Instructions and Prompty Template files are required for the agent to function properly." TextWrapping="Wrap"/>
							</StackPanel>
						</Border>

						<!-- Success Messages -->
						<Border IsVisible="{Binding !HasError}"
                                Background="#e6f4ea"
                                BorderBrush="#81c784"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="16">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<TextBlock Text="âœ…" Classes="BodyMedium" VerticalAlignment="Top"/>
								<TextBlock Classes="BodySmall" Text="Agent configuration is complete and ready to use." TextWrapping="Wrap"/>
							</StackPanel>
						</Border>

						<!-- Template Buttons -->
						<StackPanel Spacing="12">
							<TextBlock Text="Quick Templates" Classes="BodyMedium" FontWeight="Medium" Foreground="#202124"/>
							<StackPanel Orientation="Horizontal" Spacing="8">
								<Button Classes="SecondaryButton"
                                        Command="{Binding LoadInstructionTemplateCommand}"
                                        Padding="12,8"
                                        CornerRadius="6">
									<TextBlock Text="Load Instruction Template" Classes="Caption"/>
								</Button>
								<Button Classes="SecondaryButton"
                                        Command="{Binding LoadPromptyTemplateCommand}"
                                        Padding="12,8"
                                        CornerRadius="6">
									<TextBlock Text="Load Prompty Template" Classes="Caption"/>
								</Button>
							</StackPanel>
						</StackPanel>

						<!-- Additional Info -->
						<Border Background="#f8f9fa" 
						        BorderBrush="#e8eaed" 
						        BorderThickness="1" 
						        CornerRadius="8" 
						        Padding="16">
							<StackPanel Spacing="8">
								<StackPanel Orientation="Horizontal" Spacing="8">
									<TextBlock Text="â„¹ï¸" Classes="BodyMedium"/>
									<StackPanel>
										<TextBlock Classes="BodySmall" Text="Agent files should be placed in the following locations:" Foreground="#5f6368" TextWrapping="Wrap"/>
										<TextBlock Text="â€¢ Instructions file (.md) - Contains the behavior guidelines" Classes="Caption" Foreground="#5f6368"/>
										<TextBlock Text="â€¢ Prompty template (.prompty) - Contains the system prompt configuration" Classes="Caption" Foreground="#5f6368"/>
									</StackPanel>
								</StackPanel>
							</StackPanel>
						</Border>

						<!-- Bottom spacing for scroll -->
						<Border Height="40"/>
					</StackPanel>
				</ScrollViewer>

				<!-- Footer Actions -->
				<Border Grid.Row="2" 
                        Padding="24,16" 
                        BorderBrush="#e8eaed" 
                        BorderThickness="0,1,0,0">
					<StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Right" 
                                Spacing="12">
						
						<!-- Cancel Button -->
						<Button Command="{Binding CancelEditCommand}"
                                Classes="SecondaryButton"
                                Padding="20,12"
                                CornerRadius="8">
							<TextBlock Text="Cancel" FontWeight="Medium" Classes="BodySmall"/>
						</Button>

						<!-- Save Button -->
						<Button Command="{Binding SaveAgentCommand}"
                                Classes="PrimaryButton"
                                Padding="20,12"
                                CornerRadius="8"
                                IsEnabled="{Binding CanSaveAgent}">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<TextBlock Text="ðŸ’¾" Classes="BodyMedium"/>
								<TextBlock Text="Save Agent" FontWeight="Medium" Classes="BodySmall"/>
							</StackPanel>
						</Button>
					</StackPanel>
				</Border>

				<!-- Loading Overlay -->
				<Border Grid.RowSpan="3" 
                        Background="#80000000" 
                        IsVisible="{Binding IsLoading}"
                        CornerRadius="12">
					<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
						<Border Width="48" Height="48" CornerRadius="24" Background="White">
							<TextBlock Text="â³" Classes="HeadlineSmall" HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<TextBlock Text="Saving agent..." Foreground="White" Classes="BodyMedium" FontWeight="Medium"/>
					</StackPanel>
				</Border>
			</Grid>
		</Border>
	</Border>
</UserControl>