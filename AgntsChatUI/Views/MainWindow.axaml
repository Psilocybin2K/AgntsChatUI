<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AgntsChatUI.ViewModels"
        xmlns:views="using:AgntsChatUI.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="AgntsChatUI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Document Chat Assistant"
        MinWidth="800" MinHeight="600">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="400"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>

		<!-- Document Management Component -->
		<views:DocumentManagementView Grid.Column="0" DataContext="{Binding DocumentManagementViewModel}"/>

		<!-- Main Chat Area -->
		<Grid Grid.Column="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<!-- Chat Header -->
			<Border Grid.Row="0" Padding="20,24" BorderBrush="#e8eaed" BorderThickness="0,0,0,1" Background="White">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
						<Border Width="40" Height="40" CornerRadius="20" Background="#4285f4">
							<TextBlock Text="🤖" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<StackPanel>
							<TextBlock Text="Document Assistant" FontSize="18" FontWeight="Medium" Foreground="#202124"/>
							<TextBlock Text="{Binding DocumentManagementViewModel.SelectedDocument.Title, FallbackValue='● Ready to analyze documents', TargetNullValue='● Ready to analyze documents'}" FontSize="13" Foreground="#34a853"/>
						</StackPanel>
					</StackPanel>

					<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
						<Button Width="40" Height="40" Background="Transparent" BorderThickness="0" CornerRadius="20" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
							<Path Data="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" Fill="#5f6368" Stretch="Uniform" Margin="3"/>
						</Button>
						<Button Width="40" Height="40" Background="Transparent" BorderThickness="0" CornerRadius="20" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
							<Path Data="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H6C4.9 1 4 1.9 4 3V21C4 22.1 4.9 23 6 23H13.34C12.5 22.25 12 21.19 12 20C12 18.81 12.5 17.75 13.34 17H6V3H14V9H21ZM20 15V18H23V20H20V23H18V20H15V18H18V15H20Z" Fill="#5f6368" Stretch="Uniform" Margin="3"/>
						</Button>
						<Button Width="40" Height="40" Background="Transparent" BorderThickness="0" CornerRadius="20" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
							<Path Data="M6,10C4.9,10 4,10.9 4,12A2,2 0 0,0 6,14A2,2 0 0,0 8,12A2,2 0 0,0 6,10M12,10C10.9,10 10,10.9 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M18,10C16.9,10 16,10.9 16,12A2,2 0 0,0 18,14A2,2 0 0,0 20,12A2,2 0 0,0 18,10Z" Fill="#5f6368" Stretch="Uniform" Margin="3" />
						</Button>
					</StackPanel>
				</Grid>
			</Border>

			<!-- Messages -->
			<ScrollViewer Grid.Row="1"
                          Background="White"
                          Name="MessagesScrollViewer"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
				<StackPanel Spacing="16" Margin="24,24,24,64">
					<ItemsControl ItemsSource="{Binding ChatViewModel.Messages}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Grid Margin="0,0,0,16">
									<!-- Message for others (AI) -->
									<StackPanel IsVisible="{Binding !IsSent}" Orientation="Horizontal" Spacing="12" MaxWidth="600" HorizontalAlignment="Left">
										<Border Width="32" Height="32" CornerRadius="16" Background="#4285f4" VerticalAlignment="Top">
											<TextBlock Text="🤖" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
										</Border>
										<StackPanel MaxWidth="500">
											<!-- Edit Mode for others -->
											<Border IsVisible="{Binding IsEditing}" Background="#f1f3f4" Padding="12,16" CornerRadius="18">
												<StackPanel Spacing="8">
													<TextBox Text="{Binding Content}"
                                                             Foreground="#202124"
                                                             Background="Transparent"
                                                             BorderThickness="0"
                                                             AcceptsReturn="True"
                                                             TextWrapping="Wrap"
                                                             Name="EditTextBoxOther"/>
													<StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
														<Button Content="Save"
                                                                Background="#4285f4"
                                                                Foreground="White"
                                                                BorderThickness="0"
                                                                CornerRadius="4"
                                                                Padding="8,4"
                                                                FontSize="12"
                                                                Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.SaveEditCommand}"
                                                                CommandParameter="{Binding}"/>
														<Button Content="Cancel"
                                                                Background="Transparent"
                                                                Foreground="#5f6368"
                                                                BorderBrush="#dadce0"
                                                                BorderThickness="1"
                                                                CornerRadius="4"
                                                                Padding="8,4"
                                                                FontSize="12"
                                                                Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.CancelEditCommand}"
                                                                CommandParameter="{Binding}"/>
													</StackPanel>
												</StackPanel>
											</Border>

											<!-- Display Mode for others -->
											<Border IsVisible="{Binding !IsEditing}" Background="#f1f3f4" Padding="12,16" CornerRadius="18">
												<Border.ContextFlyout>
													<MenuFlyout>
														<MenuItem Header="Edit" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.EditMessageCommand}" CommandParameter="{Binding}">
															<MenuItem.Icon>
																<Path Data="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" Fill="Gray" Stretch="Uniform" Width="16" Height="16"/>
															</MenuItem.Icon>
														</MenuItem>
														<MenuItem Header="Delete" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.DeleteMessageCommand}" CommandParameter="{Binding}">
															<MenuItem.Icon>
																<Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" Fill="Gray" Stretch="Uniform" Width="16" Height="16"/>
															</MenuItem.Icon>
														</MenuItem>
													</MenuFlyout>
												</Border.ContextFlyout>
												<TextBlock Text="{Binding Content}" FontSize="14" Foreground="#202124" TextWrapping="Wrap"/>
											</Border>

											<!-- File attachment for others -->
											<Border IsVisible="{Binding HasFile}" Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,8,0,0">
												<Grid>
													<Grid.ColumnDefinitions>
														<ColumnDefinition Width="Auto"/>
														<ColumnDefinition Width="*"/>
														<ColumnDefinition Width="Auto"/>
													</Grid.ColumnDefinitions>
													<Border Grid.Column="0" Width="40" Height="40" CornerRadius="8" Background="#4285f4" Margin="0,0,12,0">
														<Path Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" Fill="White" Stretch="Uniform" Width="20" Height="20"/>
													</Border>
													<StackPanel Grid.Column="1">
														<TextBlock Text="{Binding FileName}" FontWeight="Medium" Foreground="#202124" FontSize="14"/>
														<TextBlock Text="{Binding FileSize}" FontSize="12" Foreground="#5f6368"/>
													</StackPanel>
													<Button Grid.Column="2" Content="Download" Background="#4285f4" Foreground="White" BorderThickness="0" CornerRadius="4" Padding="6,12" FontSize="12" Margin="12,0"/>
												</Grid>
											</Border>

											<TextBlock Text="{Binding Time, StringFormat='h:mm tt'}" FontSize="11" Foreground="#5f6368" Margin="0,4,0,0"/>
										</StackPanel>
									</StackPanel>

									<!-- Message for self -->
									<StackPanel IsVisible="{Binding IsSent}" Orientation="Horizontal" Spacing="12" MaxWidth="600" HorizontalAlignment="Right">
										<StackPanel MaxWidth="500">
											<!-- Edit Mode -->
											<Border IsVisible="{Binding IsEditing}" Background="#4285f4" Padding="12,16" CornerRadius="18">
												<StackPanel Spacing="8">
													<TextBox Text="{Binding Content}"
                                                             Foreground="White"
                                                             Background="Transparent"
                                                             BorderThickness="0"
                                                             AcceptsReturn="True"
                                                             TextWrapping="Wrap"
                                                             Name="EditTextBox"/>
													<StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
														<Button Content="Save"
                                                                Background="White"
                                                                Foreground="#4285f4"
                                                                BorderThickness="0"
                                                                CornerRadius="4"
                                                                Padding="8,4"
                                                                FontSize="12"
                                                                Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.SaveEditCommand}"
                                                                CommandParameter="{Binding}"/>
														<Button Content="Cancel"
                                                                Background="Transparent"
                                                                Foreground="White"
                                                                BorderBrush="White"
                                                                BorderThickness="1"
                                                                CornerRadius="4"
                                                                Padding="8,4"
                                                                FontSize="12"
                                                                Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.CancelEditCommand}"
                                                                CommandParameter="{Binding}"/>
													</StackPanel>
												</StackPanel>
											</Border>

											<!-- Display Mode -->
											<Border IsVisible="{Binding !IsEditing}" Background="#4285f4" Padding="12,16" CornerRadius="18">
												<Border.ContextFlyout>
													<MenuFlyout>
														<MenuItem Header="Edit" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.EditMessageCommand}" CommandParameter="{Binding}">
															<MenuItem.Icon>
																<Path Data="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" Fill="Gray" Stretch="Uniform" Width="16" Height="16"/>
															</MenuItem.Icon>
														</MenuItem>
														<MenuItem Header="Delete" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChatViewModel.DeleteMessageCommand}" CommandParameter="{Binding}">
															<MenuItem.Icon>
																<Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" Fill="Gray" Stretch="Uniform" Width="16" Height="16"/>
															</MenuItem.Icon>
														</MenuItem>
													</MenuFlyout>
												</Border.ContextFlyout>
												<TextBlock Text="{Binding Content}" FontSize="14" Foreground="White" TextWrapping="Wrap"/>
											</Border>

											<TextBlock Text="{Binding Time, StringFormat='h:mm tt'}" FontSize="11" Foreground="#5f6368" Margin="0,4,0,0" HorizontalAlignment="Right"/>
										</StackPanel>
										<Border Width="32" Height="32" CornerRadius="16" Background="#34a853" VerticalAlignment="Top">
											<TextBlock Text="{Binding Avatar}" FontSize="12" FontWeight="Medium" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
										</Border>
									</StackPanel>
								</Grid>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>

					<!-- Typing Indicator -->
					<StackPanel IsVisible="{Binding ChatViewModel.IsTyping}" Orientation="Horizontal" Spacing="12" MaxWidth="600" HorizontalAlignment="Left" Margin="0,0,0,16">
						<Border Width="32" Height="32" CornerRadius="16" Background="#4285f4" VerticalAlignment="Top">
							<TextBlock Text="🤖" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<Border Background="#f1f3f4" Padding="12,16" CornerRadius="18">
							<StackPanel Orientation="Horizontal" Spacing="4">
								<Border Width="8" Height="8" CornerRadius="4" Background="#5f6368" Name="Dot1">
									<Border.Styles>
										<Style Selector="Border">
											<Style.Animations>
												<Animation Duration="0:0:1.5" IterationCount="INFINITE">
													<KeyFrame Cue="0%">
														<Setter Property="Opacity" Value="0.4"/>
													</KeyFrame>
													<KeyFrame Cue="50%">
														<Setter Property="Opacity" Value="1"/>
													</KeyFrame>
													<KeyFrame Cue="100%">
														<Setter Property="Opacity" Value="0.4"/>
													</KeyFrame>
												</Animation>
											</Style.Animations>
										</Style>
									</Border.Styles>
								</Border>
								<Border Width="8" Height="8" CornerRadius="4" Background="#5f6368" Name="Dot2">
									<Border.Styles>
										<Style Selector="Border">
											<Style.Animations>
												<Animation Duration="0:0:1.5" IterationCount="INFINITE" Delay="0:0:0.2">
													<KeyFrame Cue="0%">
														<Setter Property="Opacity" Value="0.4"/>
													</KeyFrame>
													<KeyFrame Cue="50%">
														<Setter Property="Opacity" Value="1"/>
													</KeyFrame>
													<KeyFrame Cue="100%">
														<Setter Property="Opacity" Value="0.4"/>
													</KeyFrame>
												</Animation>
											</Style.Animations>
										</Style>
									</Border.Styles>
								</Border>
								<Border Width="8" Height="8" CornerRadius="4" Background="#5f6368" Name="Dot3">
									<Border.Styles>
										<Style Selector="Border">
											<Style.Animations>
												<Animation Duration="0:0:1.5" IterationCount="INFINITE" Delay="0:0:0.4">
													<KeyFrame Cue="0%">
														<Setter Property="Opacity" Value="0.4"/>
													</KeyFrame>
													<KeyFrame Cue="50%">
														<Setter Property="Opacity" Value="1"/>
													</KeyFrame>
													<KeyFrame Cue="100%">
														<Setter Property="Opacity" Value="0.4"/>
													</KeyFrame>
												</Animation>
											</Style.Animations>
										</Style>
									</Border.Styles>
								</Border>
							</StackPanel>
						</Border>
					</StackPanel>
				</StackPanel>
			</ScrollViewer>

			<!-- Input Area -->
			<Border Grid.Row="2" Padding="16,24" BorderBrush="#e8eaed" BorderThickness="0,1,0,0" Background="White">
				<StackPanel Spacing="12">
					<!-- Quick Reactions -->
					<StackPanel Orientation="Horizontal" Spacing="4">
						<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="16" Padding="4,8">
							<TextBlock Text="👍" FontSize="16"/>
						</Border>
						<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="16" Padding="4,8">
							<TextBlock Text="❤️" FontSize="16"/>
						</Border>
						<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="16" Padding="4,8">
							<TextBlock Text="😂" FontSize="16"/>
						</Border>
						<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="16" Padding="4,8">
							<TextBlock Text="😮" FontSize="16"/>
						</Border>
						<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="16" Padding="4,8">
							<TextBlock Text="😢" FontSize="16"/>
						</Border>
						<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="1" CornerRadius="16" Padding="4,8">
							<TextBlock Text="👏" FontSize="16"/>
						</Border>
					</StackPanel>

					<!-- Input Controls -->
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<Button Grid.Column="0" Width="36" Height="36" Background="Transparent" BorderThickness="0" CornerRadius="18" Margin="0,0,12,0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
							<Path Data="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" Fill="#5f6368" Stretch="Uniform" Width="18" Height="18"/>
						</Button>
						<Button Grid.Column="1" Width="36" Height="36" Background="Transparent" BorderThickness="0" CornerRadius="18" Margin="0,0,12,0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
							<Path Data="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H6C4.9 1 4 1.9 4 3V21C4 22.1 4.9 23 6 23H13.34C12.5 22.25 12 21.19 12 20C12 18.81 12.5 17.75 13.34 17H6V3H14V9H21ZM20 15V18H23V20H20V23H18V20H15V18H18V15H20Z" Fill="#5f6368" Stretch="Uniform" Width="18" Height="18"/>
						</Button>

						<TextBox Grid.Column="2"
                                 Text="{Binding ChatViewModel.MessageText}"
                                 Watermark="Ask about your documents..."
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MaxHeight="120"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 BorderBrush="#dadce0"
                                 BorderThickness="1"
                                 CornerRadius="24"
                                 Padding="12,16"
                                 Margin="0,0,12,0"
                                 Name="MessageTextBox">
							<TextBox.KeyBindings>
								<KeyBinding Gesture="Enter" Command="{Binding ChatViewModel.SendMessageCommand}"/>
							</TextBox.KeyBindings>
						</TextBox>

						<Button Grid.Column="3"
                                Width="44" Height="44"
                                Background="#4285f4"
                                BorderThickness="0"
                                CornerRadius="22"
                                Foreground="White"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding ChatViewModel.SendMessageCommand}">
							<Path Data="M2,21L23,12L2,3V10L17,12L2,14V21Z" Fill="White" Stretch="Uniform" Width="20" Height="20"/>
						</Button>
					</Grid>
				</StackPanel>
			</Border>
		</Grid>
	</Grid>
</Window>