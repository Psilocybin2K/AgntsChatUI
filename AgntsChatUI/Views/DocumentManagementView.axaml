<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AgntsChatUI.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="380" d:DesignHeight="800"
             x:Class="AgntsChatUI.Views.DocumentManagementView"
             x:DataType="vm:DocumentManagementViewModel">

	<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="0,0,1,0">
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Header with Collapse/Expand -->
			<Border Grid.Row="0" Padding="0" BorderBrush="#e8eaed" BorderThickness="0,0,0,1">
				<Grid>
					<!-- Expanded Layout -->
					<Grid IsVisible="{Binding IsExpanded}" Margin="20">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<!-- Collapse Button -->
						<Button Grid.Column="0" 
						        Classes="IconButton" 
						        Command="{Binding ToggleExpandedCommand}"
						        Width="40" Height="40"
						        Margin="0,0,12,0"
						        ToolTip.Tip="Click to collapse panel">
							<Grid>
								<TextBlock Text="â–¼" FontSize="12" Foreground="#5f6368" HorizontalAlignment="Center" VerticalAlignment="Center"/>
							</Grid>
						</Button>

						<!-- Title Section -->
						<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
							<Border Width="40" Height="40" CornerRadius="20" Background="#4285f4">
								<TextBlock Text="ðŸ“" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
							</Border>
							<StackPanel>
								<TextBlock Text="Document Library" FontSize="24" FontWeight="Medium" Foreground="#202124"/>
								<TextBlock Text="Upload and manage documents for AI context" FontSize="14" Foreground="#5f6368"/>
							</StackPanel>
						</StackPanel>
					</Grid>

					<!-- Collapsed Layout -->
					<StackPanel IsVisible="{Binding !IsExpanded}" 
					           Orientation="Vertical" 
					           HorizontalAlignment="Center" 
					           VerticalAlignment="Center"
					           Spacing="8"
					           Margin="0,12">
						<!-- Expand Button -->
						<Button Classes="IconButton" 
						        Command="{Binding ToggleExpandedCommand}"
						        Width="32" Height="32"
						        ToolTip.Tip="Click to expand panel"
						        HorizontalAlignment="Center">
							<TextBlock Text="â–¶" FontSize="12" Foreground="#5f6368" HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Button>
						
						<!-- Icon and Label -->
						<TextBlock Text="ðŸ“" FontSize="16" HorizontalAlignment="Center"/>
						<TextBlock Text="Docs" FontSize="9" FontWeight="Medium" Foreground="#202124" HorizontalAlignment="Center"/>
					</StackPanel>
				</Grid>
			</Border>

			<!-- Upload Button -->
			<Border Grid.Row="1" Margin="16" Padding="16" Background="#4285f4" CornerRadius="12" IsVisible="{Binding IsExpanded}">
				<Button Classes="UploadButton"
                        Command="{Binding UploadDocumentCommand}">
					<Button.ContentTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
								<Border Width="24" Height="24" CornerRadius="12" Background="White">
									<TextBlock Text="ðŸ“¤" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
								</Border>
								<StackPanel>
									<TextBlock Text="Upload Document" FontWeight="Medium" FontSize="16"/>
									<TextBlock Text="Add files to enhance AI responses" FontSize="12" Opacity="0.9"/>
								</StackPanel>
							</StackPanel>
						</DataTemplate>
					</Button.ContentTemplate>
				</Button>
			</Border>

			<!-- Document Count and Filter -->
			<Border Grid.Row="2" Padding="20,16" BorderBrush="#e8eaed" BorderThickness="0,0,0,1" IsVisible="{Binding IsExpanded}">
				<StackPanel Spacing="8">
					<TextBlock Text="{Binding Documents.Count, StringFormat='DOCUMENTS ({0})'}" FontSize="12" FontWeight="Medium" Foreground="#5f6368"/>
					<TextBlock Text="Check documents to include in chat context" FontSize="12" Foreground="#5f6368"/>
				</StackPanel>
			</Border>

			<!-- Document List -->
			<ScrollViewer Grid.Row="3" Padding="12" IsVisible="{Binding IsExpanded}">
				<ItemsControl ItemsSource="{Binding Documents}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Border Padding="16,20" 
							        Margin="0,0,0,12" 
							        CornerRadius="12" 
							        Background="White"
							        BorderBrush="#e8eaed"
							        BorderThickness="1">
								<Border.Styles>
									<Style Selector="Border:pointerover">
										<Setter Property="Background" Value="#f8f9fa"/>
										<Setter Property="BorderBrush" Value="#4285f4"/>
									</Style>
								</Border.Styles>
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Include in Chat Checkbox -->
									<CheckBox Grid.Column="0"
                                              IsChecked="{Binding IsIncludedInChat}"
                                              VerticalAlignment="Top"
                                              Margin="0,2,12,0"
                                              ToolTip.Tip="Include in chat context"/>

									<!-- File Icon -->
									<Border Grid.Column="1" Width="48" Height="48" CornerRadius="12" Background="{Binding FileTypeColor}" Margin="0,0,16,0">
										<TextBlock Text="{Binding FileTypeIcon}" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
									</Border>

									<!-- Document Info (Clickable for selection) -->
									<Button Grid.Column="2"
                                            Classes="TransparentButton"
                                            Command="{Binding $parent[UserControl].DataContext.SelectDocumentCommand}"
                                            CommandParameter="{Binding}"
                                            Padding="0"
                                            HorizontalContentAlignment="Left"
                                            VerticalContentAlignment="Top">
										<StackPanel Spacing="6">
											<!-- Title Display Mode -->
											<TextBlock IsVisible="{Binding !IsEditingTitle}"
                                                       Text="{Binding Title}"
                                                       FontWeight="Medium"
                                                       FontSize="16"
                                                       Foreground="#202124"
                                                       TextTrimming="CharacterEllipsis"/>

											<!-- Title Edit Mode -->
											<TextBox IsVisible="{Binding IsEditingTitle}"
                                                     Text="{Binding Title}"
                                                     FontWeight="Medium"
                                                     FontSize="16"
                                                     Foreground="#202124"
                                                     Background="White"
                                                     BorderBrush="#4285f4"
                                                     BorderThickness="1"
                                                     CornerRadius="6"
                                                     Padding="8">
												<TextBox.KeyBindings>
													<KeyBinding Gesture="Enter" Command="{Binding $parent[UserControl].DataContext.SaveDocumentTitleCommand}" CommandParameter="{Binding}"/>
													<KeyBinding Gesture="Escape" Command="{Binding $parent[UserControl].DataContext.CancelEditTitleCommand}" CommandParameter="{Binding}"/>
												</TextBox.KeyBindings>
											</TextBox>

											<TextBlock Text="{Binding FileName}" FontSize="13" Foreground="#5f6368"/>
											<StackPanel Orientation="Horizontal" Spacing="16">
												<TextBlock Text="{Binding Size}" FontSize="12" Foreground="#5f6368"/>
												<TextBlock Text="{Binding DateAdded, StringFormat='Added {0:MMM d, yyyy}'}" FontSize="12" Foreground="#5f6368"/>
											</StackPanel>
										</StackPanel>
									</Button>

									<!-- Action Buttons -->
									<StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" VerticalAlignment="Top">
										<!-- Edit Title Button -->
										<Button IsVisible="{Binding !IsEditingTitle}"
                                                Classes="IconButton"
                                                ToolTip.Tip="Edit Title"
                                                Command="{Binding $parent[UserControl].DataContext.EditDocumentTitleCommand}"
                                                CommandParameter="{Binding}"
                                                Width="32" Height="32">
											<Path Data="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
                                                  Fill="#5f6368"
                                                  Stretch="Uniform"
                                                  Width="16" Height="16"/>
										</Button>

										<!-- Save Title Button -->
										<Button IsVisible="{Binding IsEditingTitle}"
                                                Classes="IconButton"
                                                ToolTip.Tip="Save"
                                                Command="{Binding $parent[UserControl].DataContext.SaveDocumentTitleCommand}"
                                                CommandParameter="{Binding}"
                                                Width="32" Height="32">
											<Path Data="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                                  Fill="#34a853"
                                                  Stretch="Uniform"
                                                  Width="16" Height="16"/>
										</Button>

										<!-- Cancel Edit Button -->
										<Button IsVisible="{Binding IsEditingTitle}"
                                                Classes="IconButton"
                                                ToolTip.Tip="Cancel"
                                                Command="{Binding $parent[UserControl].DataContext.CancelEditTitleCommand}"
                                                CommandParameter="{Binding}"
                                                Width="32" Height="32">
											<Path Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                                  Fill="#ea4335"
                                                  Stretch="Uniform"
                                                  Width="16" Height="16"/>
										</Button>

										<!-- Delete Button -->
										<Button IsVisible="{Binding !IsEditingTitle}"
                                                Classes="IconButton"
                                                ToolTip.Tip="Delete"
                                                Command="{Binding $parent[UserControl].DataContext.DeleteDocumentCommand}"
                                                CommandParameter="{Binding}"
                                                Width="32" Height="32">
											<Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
                                                  Fill="#5f6368"
                                                  Stretch="Uniform"
                                                  Width="18" Height="18"/>
										</Button>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</ScrollViewer>

			<!-- Upload Dialog Overlay -->
			<Border Grid.RowSpan="4"
                    IsVisible="{Binding IsUploadDialogOpen}"
                    Background="#80000000"
                    ZIndex="100">
				<Border Background="White"
                        CornerRadius="12"
                        Padding="32"
                        MaxWidth="450"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        BoxShadow="0 8 32 0 #40000000">
					<StackPanel Spacing="20">
						<StackPanel Spacing="8">
							<TextBlock Text="Set Document Title"
                                       FontSize="24"
                                       FontWeight="Medium"
                                       Foreground="#202124"
                                       HorizontalAlignment="Center"/>
							<TextBlock Text="Choose a custom title for your document or use the default filename."
                                       FontSize="16"
                                       Foreground="#5f6368"
                                       TextWrapping="Wrap"
                                       HorizontalAlignment="Center"
                                       TextAlignment="Center"/>
						</StackPanel>

						<TextBox Text="{Binding UploadTitle}"
                                 Watermark="Enter document title..."
                                 BorderBrush="#dadce0"
                                 BorderThickness="1"
                                 CornerRadius="8"
                                 Padding="16,12"
                                 FontSize="16">
							<TextBox.KeyBindings>
								<KeyBinding Gesture="Enter" Command="{Binding ConfirmUploadCommand}"/>
								<KeyBinding Gesture="Escape" Command="{Binding CancelUploadCommand}"/>
							</TextBox.KeyBindings>
						</TextBox>

						<StackPanel Orientation="Horizontal"
                                    Spacing="16"
                                    HorizontalAlignment="Center">
							<Button Classes="PrimaryButton"
                                    Content="Upload"
                                    Padding="24,12"
                                    CornerRadius="8"
                                    FontSize="16"
                                    Command="{Binding ConfirmUploadCommand}"/>

							<Button Classes="SecondaryButton"
                                    Content="Cancel"
                                    Padding="24,12"
                                    CornerRadius="8"
                                    FontSize="16"
                                    Command="{Binding CancelUploadCommand}"/>
						</StackPanel>
					</StackPanel>
				</Border>
			</Border>
		</Grid>
	</Border>
</UserControl>