<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:AgntsChatUI.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="320" d:DesignHeight="800"
             x:Class="AgntsChatUI.Views.DocumentManagementView"
             x:DataType="vm:DocumentManagementViewModel">

	<Design.DataContext>
		<vm:DocumentManagementViewModel/>
	</Design.DataContext>

	<Border Background="#f8f9fa" BorderBrush="#e8eaed" BorderThickness="0,0,1,0">
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Header -->
			<Border Grid.Row="0" Padding="20" BorderBrush="#e8eaed" BorderThickness="0,0,0,1">
				<StackPanel Orientation="Horizontal" Spacing="12">
					<Border Width="32" Height="32" CornerRadius="16" Background="#4285f4">
						<TextBlock Text="📁" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
					</Border>
					<TextBlock Text="Documents" FontSize="22" FontWeight="Normal" Foreground="#202124" VerticalAlignment="Center"/>
				</StackPanel>
			</Border>

			<!-- Upload Button -->
			<Border Grid.Row="1" Margin="16" Padding="12" Background="#4285f4" CornerRadius="8">
				<Button Content="Upload Document"
                        Background="Transparent"
                        Foreground="White"
                        BorderThickness="0"
                        HorizontalAlignment="Stretch"
                        Command="{Binding UploadDocumentCommand}">
					<Button.ContentTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
								<TextBlock Text="📤" FontSize="16"/>
								<TextBlock Text="Upload Document" FontWeight="Medium"/>
							</StackPanel>
						</DataTemplate>
					</Button.ContentTemplate>
				</Button>
			</Border>

			<!-- Document Count -->
			<Border Grid.Row="2" Padding="16" BorderBrush="#e8eaed" BorderThickness="0,0,0,1">
				<TextBlock Text="{Binding Documents.Count, StringFormat='DOCUMENTS ({0})'}" FontSize="12" FontWeight="Medium" Foreground="#5f6368"/>
			</Border>

			<!-- Document List -->
			<ScrollViewer Grid.Row="3" Padding="8">
				<ItemsControl ItemsSource="{Binding Documents}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Border Padding="12,16" Margin="0,0,0,4" CornerRadius="8" Background="Transparent">
								<Border.Styles>
									<Style Selector="Border:pointerover">
										<Setter Property="Background" Value="#e8f0fe"/>
									</Style>
								</Border.Styles>
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Include in Chat Checkbox -->
									<CheckBox Grid.Column="0"
                                              IsChecked="{Binding IsIncludedInChat}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,8,0"
                                              ToolTip.Tip="Include in chat context"/>

									<!-- File Icon -->
									<Border Grid.Column="1" Width="40" Height="40" CornerRadius="8" Background="{Binding FileTypeColor}" Margin="0,0,12,0">
										<TextBlock Text="{Binding FileTypeIcon}" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
									</Border>

									<!-- Document Info (Clickable for selection) -->
									<Button Grid.Column="2"
                                            Background="Transparent"
                                            BorderThickness="0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            Command="{Binding $parent[UserControl].DataContext.SelectDocumentCommand}"
                                            CommandParameter="{Binding}">
										<StackPanel>
											<!-- Title Display Mode -->
											<TextBlock IsVisible="{Binding !IsEditingTitle}"
                                                       Text="{Binding Title}"
                                                       FontWeight="Medium"
                                                       Foreground="#202124"
                                                       Margin="0,0,0,2"
                                                       TextTrimming="CharacterEllipsis"/>

											<!-- Title Edit Mode -->
											<TextBox IsVisible="{Binding IsEditingTitle}"
                                                     Text="{Binding Title}"
                                                     FontWeight="Medium"
                                                     Foreground="#202124"
                                                     Background="White"
                                                     BorderBrush="#4285f4"
                                                     BorderThickness="1"
                                                     CornerRadius="4"
                                                     Padding="4"
                                                     Margin="0,0,0,2">
												<TextBox.KeyBindings>
													<KeyBinding Gesture="Enter" Command="{Binding $parent[UserControl].DataContext.SaveDocumentTitleCommand}" CommandParameter="{Binding}"/>
													<KeyBinding Gesture="Escape" Command="{Binding $parent[UserControl].DataContext.CancelEditTitleCommand}" CommandParameter="{Binding}"/>
												</TextBox.KeyBindings>
											</TextBox>

											<TextBlock Text="{Binding FileName}" FontSize="11" Foreground="#5f6368" Margin="0,0,0,2"/>
											<TextBlock Text="{Binding Size}" FontSize="12" Foreground="#5f6368"/>
											<TextBlock Text="{Binding DateAdded, StringFormat='Added {0:MMM d, yyyy}'}" FontSize="11" Foreground="#5f6368"/>
										</StackPanel>
									</Button>

									<!-- Action Buttons -->
									<StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4">
										<!-- Edit Title Button -->
										<Button IsVisible="{Binding !IsEditingTitle}"
                                                Width="24" Height="24"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                CornerRadius="12"
                                                ToolTip.Tip="Edit Title"
                                                Command="{Binding $parent[UserControl].DataContext.EditDocumentTitleCommand}"
                                                CommandParameter="{Binding}">
											<Path Data="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
                                                  Fill="#5f6368"
                                                  Stretch="Uniform"
                                                  Width="14" Height="14"/>
										</Button>

										<!-- Save Title Button -->
										<Button IsVisible="{Binding IsEditingTitle}"
                                                Width="24" Height="24"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                CornerRadius="12"
                                                ToolTip.Tip="Save"
                                                Command="{Binding $parent[UserControl].DataContext.SaveDocumentTitleCommand}"
                                                CommandParameter="{Binding}">
											<Path Data="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                                  Fill="#34a853"
                                                  Stretch="Uniform"
                                                  Width="14" Height="14"/>
										</Button>

										<!-- Cancel Edit Button -->
										<Button IsVisible="{Binding IsEditingTitle}"
                                                Width="24" Height="24"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                CornerRadius="12"
                                                ToolTip.Tip="Cancel"
                                                Command="{Binding $parent[UserControl].DataContext.CancelEditTitleCommand}"
                                                CommandParameter="{Binding}">
											<Path Data="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                                  Fill="#ea4335"
                                                  Stretch="Uniform"
                                                  Width="14" Height="14"/>
										</Button>

										<!-- Delete Button -->
										<Button IsVisible="{Binding !IsEditingTitle}"
                                                Width="24" Height="24"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                CornerRadius="12"
                                                ToolTip.Tip="Delete"
                                                Command="{Binding $parent[UserControl].DataContext.DeleteDocumentCommand}"
                                                CommandParameter="{Binding}">
											<Path Data="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
                                                  Fill="#5f6368"
                                                  Stretch="Uniform"
                                                  Width="16" Height="16"/>
										</Button>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</ScrollViewer>

			<!-- Upload Dialog Overlay -->
			<Border Grid.RowSpan="4"
                    IsVisible="{Binding IsUploadDialogOpen}"
                    Background="#80000000"
                    ZIndex="100">
				<Border Background="White"
                        CornerRadius="8"
                        Padding="24"
                        MaxWidth="400"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        BoxShadow="0 4 20 0 #40000000">
					<StackPanel Spacing="16">
						<TextBlock Text="Set Document Title"
                                   FontSize="18"
                                   FontWeight="Medium"
                                   Foreground="#202124"
                                   HorizontalAlignment="Center"/>

						<TextBlock Text="Choose a custom title for your document or use the default filename."
                                   FontSize="14"
                                   Foreground="#5f6368"
                                   TextWrapping="Wrap"
                                   HorizontalAlignment="Center"/>

						<TextBox Text="{Binding UploadTitle}"
                                 Watermark="Enter document title..."
                                 BorderBrush="#dadce0"
                                 BorderThickness="1"
                                 CornerRadius="4"
                                 Padding="12"
                                 FontSize="14">
							<TextBox.KeyBindings>
								<KeyBinding Gesture="Enter" Command="{Binding ConfirmUploadCommand}"/>
								<KeyBinding Gesture="Escape" Command="{Binding CancelUploadCommand}"/>
							</TextBox.KeyBindings>
						</TextBox>

						<StackPanel Orientation="Horizontal"
                                    Spacing="12"
                                    HorizontalAlignment="Center">
							<Button Content="Upload"
                                    Background="#4285f4"
                                    Foreground="White"
                                    BorderThickness="0"
                                    CornerRadius="4"
                                    Padding="16,8"
                                    FontWeight="Medium"
                                    MinWidth="80"
                                    Command="{Binding ConfirmUploadCommand}"/>

							<Button Content="Cancel"
                                    Background="Transparent"
                                    Foreground="#5f6368"
                                    BorderBrush="#dadce0"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="16,8"
                                    FontWeight="Medium"
                                    MinWidth="80"
                                    Command="{Binding CancelUploadCommand}"/>
						</StackPanel>
					</StackPanel>
				</Border>
			</Border>
		</Grid>
	</Border>
</UserControl>